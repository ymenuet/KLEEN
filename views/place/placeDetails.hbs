<div class="main-text">
  {{#if errorComment}}
  <p class="error-message">{{errorComment}}</p>
  {{/if}}
  <h2 class="card-title">{{place.name}}</h2>
  <div id="map" style="width:80%; height: 400px; margin:0 auto;"></div>

  {{#if userCheck}}
  <a class="signup my-btn" href="/places/edit/{{place._id}}">Edit place</a>
  <a class="login my-btn" href="/places/delete/{{place._id}}">Delete place</a>
  {{/if}}

  <div class="avg-box">
    <h5>Average Score: <span>{{place.averageScore}}</span> (total of {{place.contributions}} comments)</h5>
    <hr>
    <h6>Facemask policy score: {{place.avgMasks}}</h6>
    <h6>Gel and Soap score: {{place.avgGel}}</h6>
    <h6>Cleanliness score: {{place.avgClean}}</h6>
    <h6>Service score: {{place.avgService}}</h6>
  </div>


  <div class="about-comment">
    <div class="add-comment">
      <h4>Post a new comment</h4>

      <form action="/comment/newComment/{{place._id}}" method="POST" id="form-container" enctype="multipart/form-data">


        <label for="content">Description:</label>
        <input type="text" name="content">
        <br>
        <br>
        <label>For every scale below, 0 means "not satisfied" and 5 "very satisfied":</label>

        <label for="scoreMasks" class="required-label">Facemask policy: how would you rate theirs? (required)</label>
        <input type="number" min="0" max="5" name="scoreMasks" placeholder="0" required>
        <br>

        <label for="scoreGel" class="required-label">Gel and soap: do they provide enough? (required)</label>
        <input type="number" min="0" max="5" name="scoreGel" placeholder="0" required>
        <br>

        <label for="scoreClean" class="required-label">Cleanliness: how would you rate the overall cleanliness of the
          place and the sanitary measures taken there? (required)</label>
        <input type="number" min="0" max="5" name="scoreClean" placeholder="0" required>
        <br>

        <label for="scoreService" class="required-label">Service: were you satisfied with the service you were provided?
          (required)</label>
        <input type="number" min="0" max="5" name="scoreService" placeholder="0" required>
        <br>
        <br>

        <label for="image">Upload an image if you want:</label>
        <div class="custom-file">
          <label class="profile-image custom-file-label " for="image">
            Add a picture from the place
          </label>
          <input type="file" name="image" class="custom-file-input" onchange="displayFileName()">
          <span class="upload"><i class="fas fa-upload"></i></span>
        </div>

        <button type="submit" class="submitbtn my-btn">Post comment</button>
      </form>
    </div>

    <div class='comments-list'>
      {{#each place.comments}}
      <div class="comments">
        <h5>Commented by {{author.username}} <img class="comment-profile-img" src="{{author.image}}" alt="image"> </h5>
        <p>{{createdAt}}</p>
        <ul class="toleft">
          {{#if scoreMasks}}
          <li>Facemasks use: {{scoreMasks}}<i class="fas fa-star"></i></li>
          {{/if}}
          {{#if scoreMasks}}
          <li>Facemasks use: {{scoreMasks}}<i class="fas fa-star"></i></li>
          {{/if}}
          {{#if scoreGel}}
          <li>Antibacterial gel available: {{scoreGel}}<i class="fas fa-star"></i></li>
          {{/if}}
          {{#if scoreClean}}
          <li>Cleanliness of the place: {{scoreClean}}<i class="fas fa-star"></i></li>
          {{/if}}
          {{#if scoreService}}
          <li>Quality of service in general: {{scoreService}}<i class="fas fa-star"></i></li>
          {{/if}}
        </ul>
        {{#if image}}
        <img class="comment-img" src="{{image}}" alt="Image">
        {{/if}}
        <p class="toleft">{{content}}</p>
      </div>
      {{/each}}
    </div>
  </div>
</div>


<script>
  window.onload = () => {
    let marker = new mapboxgl.Marker()
      .setLngLat([{{ place.location.coordinates }}])
      .addTo(map);
  map.flyTo({
    center: [{{ place.location.coordinates }}]
    })

  document.querySelector(".upload").addEventListener("click", () => {
    document.querySelector(".custom-file-label").innerHTML = document.querySelector(".custom-file-input").value;
  })
  }
</script>